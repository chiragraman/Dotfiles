#!/bin/zsh
#
# dot_update
#
# `dot_update` handles installation, updates, things like that. Run it periodically
# to make sure you're on the latest and greatest.

export DOTFILES="$HOME/.dotfiles"
cd "$DOTFILES" || exit 1

# Set OS defaults
echo "› Set OS defaults"
"$DOTFILES/osx/set-defaults.sh"
"$DOTFILES/linux/set-defaults.sh"

# Install homebrew
echo "› homebrew/install.sh"
"$DOTFILES/homebrew/install.sh"
source $DOTFILES/homebrew/path.zsh

echo "› brew update"
brew update

echo "› Grab latest dircolors"
curl https://raw.githubusercontent.com/seebi/dircolors-solarized/master/dircolors.256dark > ~/.dircolors

# Update repo
echo "› git update"
git pull --rebase --stat updates "$(git rev-parse --abbrev-ref HEAD)"

# Update submodules
echo "› submodules update"
git submodule update --init --recursive --remote --merge --quiet

# Run all installs
echo "› $DOTFILES/script/install"
"$DOTFILES/script/install"

if which antibody >/dev/null 2>&1; then
  echo "› antibody update"
  antibody update
fi

echo "› registering last update"
git config --global dotfiles.lastupdate "$(date +%Y%m%d%H%M)"
